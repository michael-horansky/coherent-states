import numpy as np
import matplotlib.pyplot as plt

from pyscf import gto, scf, fci
from mol_solver_degenerate import ground_state_solver

import functions


n2_mol = gto.Mole()
n2_mol.build(
    atom = '''
    N    0.0000000000   0.0000000000  -1.0374595677
    N    0.0000000000   0.0000000000   1.0374595677
    ''',
    basis = 'sto-3g'
)


mol_solver = ground_state_solver(f"debugger_mol_N2")
mol_solver.initialise_molecule(n2_mol)

CS_sample = [

        # Z_0
        [
            [
                [0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j]
            ],
            [
                [0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j]
            ]
        ],

        # Z_1
        [
            [
                [-5.40431121e-03+5.96985596e-02j, -1.03690949e-02-1.35442997e-01j,
                    -1.03172345e-01+8.56530670e-02j,  1.69138546e-01+4.79560838e-02j,
                    -1.04965501e-01-5.82818744e-02j,  1.42561539e+01+1.15494347e+00j,
                    4.32777222e+00-1.61119111e+01j],
                [-6.33816581e-02-2.40454473e-02j,  2.74107871e-02+8.25532721e-03j,
                    -2.89271929e-02-1.73897663e-02j,  1.26938359e-01-6.22158529e-02j,
                    5.11727575e-02+2.14896976e-01j, -1.69965292e-02+5.30282838e+00j,
                    -5.40325802e+00+8.73387795e+00j],
                [ 3.64906201e-02+1.46707398e-01j,  4.24918628e-02-1.25929225e-01j,
                    -1.24327309e-01+1.75392981e-01j,  8.32474222e-03-2.16112056e-02j,
                    -2.00591704e-02-9.61817299e-02j,  3.99523735e+00-6.49954188e+00j,
                    1.21080928e+01+1.98334311e+01j]
            ],
            [
                [ 1.96326342e-01+1.03665977e-01j,  7.09818581e-02+1.01489946e-01j,
                    2.52406059e-02-1.76338033e-01j, -7.13505796e-02+2.27470680e-02j,
                    8.94241780e-02+3.77909835e-02j,  8.97868416e+00+1.12703591e+01j,
                    -4.22872826e+00+3.69750324e+00j],
                [ 6.64699242e-02+2.44243064e-01j, -9.00079749e-02-1.42427568e-01j,
                    8.09146505e-03-5.44875066e-02j, -5.79372812e-02-5.58447143e-02j,
                    -1.51508234e-02+6.59187493e-02j, -7.07475429e-01+7.43442702e+00j,
                    -2.34466375e+01-2.71358452e+00j],
                [ 5.20990405e-02-8.83161757e-02j, -2.07799766e-02-1.15326487e-01j,
                    1.34466087e-01-6.19216475e-04j,  1.20318056e-01+1.51906319e-01j,
                    -1.43861846e-02-8.48312524e-02j, -6.31205805e+00+2.39613757e+00j,
                    1.13836390e+00+1.79839655e+01j]
            ]
        ],

        # Z_2
        [
            [
                [ -0.13901714-0.04387149j,   0.20324895-0.0132949j ,
                    0.12714777+0.02621832j,  -0.0280972 +0.0980959j ,
                    0.02814703-0.02113204j,   5.18430386+2.12208905j,
                    -11.41687602-5.39639192j],
                [  0.1001923 +0.05983879j,  -0.02367918-0.19009783j,
                    -0.07736566-0.05019014j,  -0.25640417+0.11779858j,
                    -0.1893602 +0.02178979j, -17.91471414-9.52865918j,
                    -12.86432072+7.23841938j],
                [  0.07454842+0.06054362j,  -0.04612209-0.166395j  ,
                    0.04048505-0.01823008j,  -0.05839347-0.16676911j,
                    0.12704156+0.07298761j,   8.40773587+7.52917069j,
                    8.22414715+1.34053421j]
            ],
            [
                [ 8.86711721e-02+6.09263255e-03j,  1.05504516e-01+6.30939099e-02j,
                    6.36739092e-02-4.63724961e-02j, -7.10093865e-02-2.27216327e-02j,
                    -7.40378377e-02-4.03389887e-03j,  4.17941943e-01+3.07115803e+00j,
                    -5.30186789e-01+2.79318194e+00j],
                [-4.09845061e-02-1.23296137e-01j, -1.23719149e-01-1.04212592e-01j,
                    1.08970862e-01+1.15783477e-01j,  3.71587274e-02+1.52211952e-02j,
                    1.10398826e-01-6.36873016e-02j,  4.16602944e+00-3.92310296e+00j,
                    -1.12105854e+00+7.38661879e+00j],
                [ 3.75160616e-02-2.20573751e-02j,  1.07752725e-01-5.19711432e-02j,
                    1.13772544e-01+3.23565083e-02j,  8.95771045e-03-5.89992825e-02j,
                    2.84211700e-02-5.99812782e-02j,  1.04004881e+01+7.29871385e+00j,
                    -6.94416546e+00-1.07572038e+01j]
            ]
        ]


    ]

weights = [ 0.84161761+1.12097486e-07j, -0.50119628+6.63971045e-03j, -0.32462582-6.62244307e-03j ]

# The evaluation of self-energy on this superposition should yield -118 H, about 10 H below the ground state
