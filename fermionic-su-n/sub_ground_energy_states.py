
import numpy as np
import matplotlib.pyplot as plt

from pyscf import gto, scf, fci
from krylov_ground_state import ground_state_solver
from coherent_states.CS_Thouless import CS_Thouless

import functions

# ------------------------------ N2

# N2: bond length ≈ 1.098 Å = 2.0749191355 Bohr
# placed symmetrically about origin: half-distance ≈ 1.0374595677 Bohr
n2_mol = gto.Mole()
n2_mol.build(
    atom = '''
    N    0.0000000000   0.0000000000  -1.0374595677
    N    0.0000000000   0.0000000000   1.0374595677
    ''',
    basis = 'sto-3g'
)


bad_state_parameters = [

    np.array([[ 1.98702355e-01+4.48112972e-02j, -3.62472733e-03-1.78726411e-01j,
         1.19583766e-01+6.76927752e-02j, -1.60385152e-01-1.53711132e-02j,
         1.21075877e-01-2.67785115e-02j, -4.04374748e-02-1.02264806e-02j,
         3.42162653e-02+1.89950233e-01j,  3.93438046e-02+2.41617738e-02j,
         8.03794887e-02+1.11758754e-02j,  1.20725938e-01+3.02599859e-02j,
         3.54777494e-02-1.12516196e-01j, -6.47305112e-02+6.88994285e-02j,
         7.96449702e-01+7.48474360e+00j, -2.95542349e+00+2.06090848e+01j],
       [ 1.16694901e-01-2.07406341e-02j, -3.69551172e-02+1.93055320e-01j,
         2.01698680e-01+1.06998173e-01j, -9.51831790e-02+1.86614838e-01j,
        -2.19819373e-02+1.40369397e-01j,  4.75332378e-03+2.21133228e-02j,
         8.19431418e-02+1.68782849e-01j, -3.68320683e-02-6.97706138e-03j,
         6.71653489e-02-2.79745546e-02j,  1.00944519e-02-7.08793690e-02j,
        -3.69122447e-02+4.03414015e-02j, -7.76192764e-02+4.07492814e-02j,
        -7.90234762e+00+1.20508465e+00j,  1.48339324e+01+5.13049125e+00j],
       [-3.40661367e-03-2.10559084e-02j, -2.89933331e-02+2.05459487e-01j,
         4.05052728e-02+1.50411940e-01j, -1.82786688e-02+1.71108647e-01j,
         1.74419466e-01-4.07896640e-02j,  1.10929804e-02+1.83383744e-01j,
         9.52164273e-02+3.64521882e-02j,  5.31306498e-02-1.46994872e-01j,
        -5.76695554e-02+5.33557796e-02j, -7.50012350e-03-6.54112881e-02j,
         4.28471214e-02-5.72647139e-03j, -1.80143852e-01+1.37024487e-01j,
        -3.65322136e+00-6.97309298e+00j,  9.71059533e-01+6.63715747e-01j],
       [ 2.62277273e-02-1.51753061e-01j,  8.13689296e-02+8.30159621e-02j,
         1.36620021e-01-3.04392641e-02j,  3.42229939e-02+5.50450421e-02j,
         2.05345883e-03-1.52929273e-01j, -9.40293927e-02-1.52028839e-01j,
         2.62544096e-01-1.83087045e-01j,  1.12666383e-01+1.23358470e-01j,
        -1.80807214e-02+5.10908028e-02j,  3.39668330e-02+1.88394525e-01j,
         9.09958407e-02-6.75030783e-02j,  7.58148253e-02+5.81285333e-02j,
        -1.86669563e+00-1.36064298e+01j, -1.79026707e+01+7.01979318e+00j],
       [ 9.63220279e-02+9.09128373e-02j,  2.76114731e-02-6.80827924e-02j,
         7.78771310e-02+8.40725570e-02j,  1.41175868e-01-6.25352529e-02j,
         3.68243386e-02+1.78875768e-01j, -5.47479535e-02+1.18178349e-01j,
        -2.77963406e-02-2.45946073e-02j,  3.10893765e-02-6.81230748e-02j,
         1.41035858e-01+3.46019926e-02j,  1.38672857e-01-7.39435272e-02j,
         7.40992178e-02-1.47576271e-02j,  1.74676499e-01+5.83679216e-02j,
        -1.68761329e+00+3.89927541e+00j, -1.30003836e+01-2.10141497e+00j],
       [ 3.04086913e-02-3.40378277e-02j, -1.26211895e-01-1.75282695e-02j,
        -1.05438224e-01-8.82039536e-02j,  6.18751509e-02+6.15232514e-03j,
        -2.43811080e-01+1.55752240e-02j, -3.19448569e-02+1.89333082e-01j,
        -4.51119853e-03-1.78487770e-02j,  1.24152050e-01+1.57305722e-01j,
        -2.65225885e-02-1.50595467e-01j, -1.06804648e-01-1.41764194e-01j,
        -1.46209642e-02-3.41127588e-02j, -5.79714442e-02-4.49060440e-02j,
         5.43246365e+00+2.78023147e+00j, -1.63221998e+01+4.23437070e+00j]]),

    np.array([[ 8.71330685e-04-4.90108769e-02j,  3.98352494e-02-9.52370075e-02j,
        -1.19402798e-01-5.83045465e-03j, -5.17184863e-02+2.05342153e-02j,
         1.43413666e-01-1.49170087e-02j, -1.57823255e-01-7.73886491e-02j,
        -1.16501818e-01+5.74760588e-03j, -1.11520334e-01+7.10737280e-02j,
         1.21615771e-01+5.94145558e-02j, -7.78621908e-02-1.10749310e-02j,
        -1.35119001e-01-2.13658541e-02j,  3.62939503e-02-3.98198583e-02j,
        -8.20307001e+00-4.92314172e+00j,  1.45354308e+01+9.57022202e+00j],
       [ 1.08460179e-03-1.40603867e-02j,  3.88716996e-02-6.98766690e-02j,
         2.00912714e-01-1.08891034e-01j,  4.50281427e-02+4.11311641e-02j,
        -4.50011456e-03-1.51291251e-01j,  2.04054615e-01+8.59969217e-02j,
         1.93217664e-01-2.17755244e-02j,  7.16715415e-02+1.99136991e-01j,
        -9.29103295e-02-7.53535512e-03j, -2.82324792e-02-1.59048469e-02j,
        -8.13788179e-02-5.31192988e-02j, -9.47117975e-02+6.39845780e-03j,
         1.15872139e+00-2.35450436e+00j,  4.44663180e+00+1.71481976e+01j],
       [ 3.31568993e-02-2.37627547e-02j, -1.42175575e-01-6.21401655e-02j,
         1.74040668e-02-2.70424261e-02j,  2.97149282e-02-6.70877958e-02j,
        -4.59502515e-02+6.34175756e-02j, -2.44500383e-02+3.34349250e-02j,
         9.53565499e-02-4.68144841e-02j, -1.44414077e-01+1.36948383e-01j,
        -4.69833456e-02+3.76397750e-03j,  6.57558849e-02-1.16666471e-01j,
         1.57899166e-01+6.74868337e-02j,  6.20951964e-02+1.56850079e-01j,
         1.25419670e+01+1.31739522e+01j,  9.95252104e+00+5.64931848e+00j],
       [-1.70818124e-02+1.20886480e-01j,  6.19090375e-02+1.92930497e-01j,
         1.06361776e-01+7.17434335e-02j,  3.28115282e-02+1.23222533e-01j,
         2.41222079e-03+1.95399352e-02j,  4.52407038e-03-1.01371863e-01j,
         4.12690876e-02-4.53666331e-02j,  1.15071978e-01-6.74019953e-02j,
         2.19986766e-01-1.74949670e-02j, -2.27745973e-01+1.44136272e-01j,
        -2.72623554e-02-1.55110920e-01j,  1.65884655e-01-6.31821425e-02j,
         1.27566872e+01-5.46315710e+00j, -2.01033392e+01-8.65290507e+00j],
       [ 3.66176783e-02-2.72581051e-02j,  1.46236109e-01-3.36999616e-02j,
        -1.04531450e-01-1.53115873e-01j,  5.44988712e-02-4.95943273e-02j,
        -7.61003758e-03-1.66556391e-01j,  2.64657151e-02+9.28467271e-03j,
         4.59812392e-02+2.18724277e-02j,  7.78417310e-02-2.35289367e-02j,
        -4.05373412e-02+1.19314136e-01j,  1.23783569e-01+2.54959674e-01j,
         1.75047409e-01-2.08142249e-01j,  5.41534812e-02-2.07740085e-02j,
         1.64581423e+00-8.62283676e-01j,  6.53980341e+00+1.33731411e+01j],
       [-2.07985124e-02-1.47027181e-01j, -2.03481832e-02-6.73501741e-02j,
         1.09009908e-01-5.07009844e-02j,  2.73949096e-02-1.15429027e-01j,
        -2.64135568e-02+1.57013583e-01j,  2.40409118e-01+5.93333117e-03j,
         6.02360788e-02-8.05896231e-02j,  1.32305291e-01+5.30132663e-02j,
         9.27291381e-03+9.79709155e-02j,  3.49837717e-03+3.27997050e-02j,
         4.58511201e-02-1.56161412e-01j,  4.11965645e-02-2.27180648e-02j,
         4.67625850e+00+4.33532655e+00j,  1.72352790e+00+5.65894798e+00j]]),

    np.array([[-3.52726052e-02+1.42925854e-01j, -3.26820445e-02+6.53318819e-02j,
        -1.02269113e-01-5.45256950e-02j, -2.16148478e-02-4.14839706e-02j,
         1.62609538e-01-4.76234652e-02j,  2.37423258e-03+2.08004454e-01j,
        -4.12343703e-03+3.38584534e-02j,  2.92475658e-02+5.82509353e-02j,
         4.58128005e-02+9.88530963e-02j,  3.64168559e-02-1.15966462e-01j,
        -1.28584482e-01-2.68122033e-02j, -1.19503066e-02-1.27826341e-01j,
         2.32615770e+00+1.29616513e+01j, -1.62900565e+01+2.44011037e+00j],
       [-6.34712339e-02+1.60502893e-01j,  2.83608046e-02-1.10257592e-01j,
        -5.31103045e-02+3.92404582e-02j, -1.21041762e-01+2.85386277e-02j,
         3.39672600e-02+1.46236503e-01j,  5.43699470e-02-1.67120664e-01j,
        -7.21607990e-02+3.12302434e-02j, -1.23368676e-01-1.60255240e-01j,
        -9.01087056e-02+1.36855309e-01j,  9.32716283e-02-5.78939565e-02j,
         1.26832078e-02+1.36485070e-01j,  3.46877148e-02-2.51123101e-01j,
        -7.72269424e+00+9.40340828e-01j, -1.96683694e+00+2.36748976e+00j],
       [-8.20959114e-02+7.69638847e-02j,  1.27428707e-01+8.25494976e-02j,
         1.41581477e-01-1.67946610e-01j,  1.44829222e-01-8.94414568e-02j,
         1.44365946e-01-5.07448901e-02j,  1.01154642e-01+1.30602334e-01j,
        -5.88099523e-02-4.05105773e-03j,  7.63008813e-02-1.11591101e-01j,
        -1.13169465e-02-4.04912426e-02j,  1.85054777e-01+9.20967745e-02j,
         2.18850430e-01+6.58757296e-03j,  2.41708305e-02-4.81937864e-02j,
         1.04052625e+01-3.87645648e+00j, -1.18397350e+01+2.61923540e+01j],
       [-1.29762065e-02-1.40887870e-01j, -7.51294817e-02-9.65579547e-02j,
        -1.14315537e-01-1.66398950e-01j,  1.79477445e-02+2.39750574e-01j,
        -4.16967215e-02+4.52298479e-02j, -5.40342333e-02-8.88320281e-02j,
         4.03232936e-02+3.62047982e-02j,  6.16971794e-02+7.08344974e-02j,
         7.00202933e-02+1.28717103e-02j, -1.59391859e-01+1.32620722e-03j,
        -3.40827483e-02-1.71329758e-02j, -2.17266164e-01+6.72515673e-02j,
        -2.68681939e+00-2.19133506e+00j, -5.64972960e+00+5.79764722e+00j],
       [ 7.94897099e-02+8.13896746e-03j,  4.08798329e-02+7.29793186e-02j,
         3.73860022e-02+1.02351350e-01j, -6.30376540e-02+1.29761109e-01j,
        -1.40573412e-01+8.33918250e-03j,  1.10441388e-02+8.07317352e-02j,
         1.10008303e-01+9.50677537e-05j, -1.37386847e-01+6.71283972e-02j,
        -4.58910001e-02-9.27284971e-02j, -1.49286908e-01-1.46111243e-01j,
        -1.36356103e-02+2.93169664e-02j,  9.58225951e-02+9.74958629e-02j,
         6.57910230e+00-1.23329747e+01j,  2.61098144e+00-3.58914403e+00j],
       [ 1.80845923e-01+6.74037073e-02j,  8.66615655e-02+1.71487260e-02j,
         1.41151516e-02-6.36522242e-02j,  2.18275014e-01+6.15728312e-02j,
         7.32011052e-02+1.19246059e-01j, -5.09767793e-03-7.72148772e-03j,
         4.64466745e-02+1.17276653e-01j, -1.27001660e-01-4.22202325e-02j,
        -1.63882033e-01+5.30859739e-02j,  1.35657888e-01+1.45950480e-01j,
         2.11453062e-01+7.23762472e-02j,  9.78881622e-02+1.68505780e-01j,
         1.46006230e+01-1.37130719e+01j, -8.59973893e-01-1.36663959e+00j]]),

    np.array([[-3.28510160e-02+5.83013530e-02j, -2.55619898e-02+1.47118514e-01j,
         1.15133575e-03+1.46649360e-01j, -1.55126832e-01+4.11954573e-02j,
        -4.53651811e-02-1.85729612e-03j, -3.14866748e-02+2.95072472e-03j,
         4.64635035e-04-8.30047837e-02j,  3.04810906e-02-5.72073710e-02j,
         8.90429876e-02+1.58398369e-01j, -3.88557927e-02-1.20559112e-02j,
         8.05966247e-02+1.46701829e-02j, -7.76503806e-02+6.54058623e-02j,
         2.38376155e+00+1.27908451e+01j, -2.27015206e+00+5.98014449e+00j],
       [-1.64285918e-01+3.21041876e-02j,  2.17333645e-01+1.03225353e-01j,
        -9.19499080e-02+1.79945315e-01j,  7.64122316e-02+5.01708053e-02j,
         5.95461504e-02+7.32808937e-03j, -4.43692666e-02-2.70993832e-02j,
        -8.41263263e-02-1.11100247e-02j, -2.27481897e-01-1.46613245e-02j,
         4.03416851e-02+5.97154537e-02j, -3.05697205e-02+9.04281483e-02j,
        -6.50996259e-03-9.07738796e-03j, -1.99017707e-01+4.95370212e-02j,
         1.50982268e+01+1.47773167e+01j,  1.04977529e+01+6.36298104e+00j],
       [ 4.36464678e-02-1.07561938e-03j,  1.54169583e-01-3.93913909e-02j,
         3.58850775e-03-7.53140511e-02j, -8.98417408e-02+1.95768939e-01j,
        -4.83791473e-03-1.99846429e-01j, -4.09638522e-02-3.87497995e-03j,
         1.72285389e-01-1.27515833e-03j,  1.77207436e-01+1.40580057e-01j,
        -4.96088066e-03+8.63763079e-02j, -4.81574490e-02+1.03998909e-01j,
        -2.17721282e-01+8.84166898e-03j,  6.44133055e-02+6.02767172e-02j,
         9.42489498e+00+2.93479121e+00j,  6.53395274e+00+1.74895456e+01j],
       [ 9.47732949e-02-1.16081117e-02j, -3.08991660e-02-8.88959654e-02j,
         1.20578522e-01+4.87129995e-02j,  1.15123426e-01+3.64035945e-02j,
        -2.26064181e-02-1.28135298e-01j, -5.14995785e-02+8.91607634e-02j,
         1.88968108e-02+4.40886356e-02j, -1.51783300e-01+8.03983153e-02j,
        -2.71514039e-02+1.41335323e-01j, -1.36658647e-01-1.42915212e-02j,
         5.56099669e-03-1.65876376e-02j, -1.12853158e-02+8.29836027e-02j,
        -2.74901600e+00+3.03040944e+00j,  9.74951333e+00+1.41252585e+01j],
       [-3.74406627e-02+3.89006306e-02j,  9.72873744e-02-1.43624255e-01j,
         1.28214891e-01-7.84091086e-02j, -2.29847304e-01-1.59583399e-01j,
         1.36071186e-01-4.15497972e-03j, -1.18228551e-01+2.92422899e-01j,
         5.07183115e-02+3.68354085e-02j, -1.13544041e-01-1.00328443e-02j,
         1.15930166e-01+3.91960515e-05j, -1.61068436e-01-3.74212494e-02j,
         1.00108156e-03-7.44596244e-02j, -4.63566736e-03+8.95381310e-04j,
        -3.20922414e-01+1.15894128e+01j,  1.54507227e+01+7.10219235e+00j],
       [ 1.37346541e-01-5.21725944e-02j,  6.23842140e-02+4.13384134e-02j,
        -6.01096967e-02+2.38878840e-03j,  1.29653257e-01+5.57978964e-02j,
         1.02074150e-01-1.97861094e-01j,  4.45036311e-02+9.20211638e-02j,
         2.61092428e-02-2.25523129e-02j, -2.41104510e-02+7.90971244e-02j,
         4.96834462e-03-9.76029803e-02j, -2.03970026e-01-1.59613029e-01j,
         5.68797520e-02+5.61564806e-02j,  1.55474380e-01+4.28785840e-02j,
        -2.92408206e+00+1.07639936e+01j,  8.08764772e+00-7.44083986e+00j]]),

    np.array([[ 2.89193088e-02+2.28671427e-02j, -1.85569405e-01+1.91303877e-01j,
        -1.57553527e-02+2.27458126e-03j, -1.43353128e-01+7.64443129e-03j,
        -1.30636730e-02-1.15338669e-01j,  4.95476743e-02+5.23050778e-04j,
        -6.04614642e-02-1.58335138e-01j,  1.57218871e-01-1.42084806e-01j,
        -5.38972296e-02+3.42012382e-02j,  1.25517415e-01-6.91464445e-02j,
         7.28484625e-02+2.14290455e-01j, -9.46348203e-02-7.93187725e-02j,
        -5.21470425e+00-2.56337546e+01j,  1.01971667e+01+1.60389383e+01j],
       [ 1.43547096e-01+5.37973163e-02j,  2.94454370e-01-1.45236451e-01j,
        -7.50064586e-02+1.91937352e-01j, -3.33527144e-02+1.24790891e-01j,
         9.63562490e-02+5.28819773e-03j, -5.57441738e-02-1.29677095e-01j,
         1.41575211e-01-6.49011895e-02j, -2.93673359e-02-1.67373961e-01j,
        -9.32549004e-02-9.17214736e-02j,  8.67595817e-03+1.26491273e-01j,
        -1.98829368e-01-3.27589625e-03j, -5.04233866e-02+6.41409944e-02j,
        -2.13066185e+01+7.58999642e-01j, -5.84112418e+00+1.64431119e+01j],
       [-7.53692994e-02-1.33121151e-01j, -4.49975242e-02-1.84651689e-01j,
         3.02424683e-02-4.73191059e-02j, -2.72907820e-02-2.98948946e-02j,
         1.13454683e-01-6.34787045e-02j, -1.97027649e-01-9.69298073e-02j,
         4.44847914e-02-9.70145051e-02j, -9.47748811e-02+2.19958282e-02j,
        -5.52119817e-04+1.55778741e-01j, -1.05196746e-02+8.07221159e-02j,
        -1.34109215e-01-1.14840703e-01j, -8.31095535e-02+2.92208362e-02j,
         2.24002366e+00-3.38688995e+00j, -2.01239189e+01-1.06301235e+01j],
       [-4.19002681e-03+1.58975240e-01j, -9.73893569e-02+1.55320727e-01j,
        -1.30903248e-02-5.39458036e-02j, -1.09447721e-01+1.66563868e-01j,
         1.59724124e-01-4.29457865e-04j,  7.02831828e-02+8.90465632e-02j,
        -5.00002021e-02+1.13759171e-01j,  3.34273932e-02-3.11443133e-01j,
         1.35417388e-01+1.57272677e-01j,  1.50225060e-02+2.03359527e-01j,
        -3.99377866e-02+2.60828864e-02j, -4.77462078e-02-6.73784109e-02j,
        -2.32772939e+00+1.80468193e+01j, -7.56080694e+00+1.98798966e-01j],
       [ 1.00554208e-01-1.14397948e-01j,  1.32319982e-01+9.45866458e-02j,
        -1.30772269e-01+1.41652135e-01j, -6.34560433e-02+1.44219294e-02j,
        -1.05317585e-01-1.19456767e-01j, -2.67143358e-02-2.09679989e-02j,
         8.39009158e-03-4.59396963e-02j, -6.24476125e-02+1.05724749e-01j,
        -1.04475170e-01+1.31115393e-02j, -1.39905494e-01+1.45856281e-02j,
        -2.83212506e-02+1.89812701e-01j, -2.90657022e-02+1.26534407e-01j,
         8.16956826e+00+1.19073469e+01j,  1.62778401e+01+4.38638530e+00j],
       [-5.69426977e-02-9.92745658e-04j,  1.00412544e-01-1.60124520e-02j,
        -9.38405007e-02-9.13109274e-02j,  5.52333964e-02+2.35517433e-03j,
         4.13811958e-03-9.83273061e-02j, -1.39254988e-01+1.17326939e-01j,
         6.61199273e-02-2.08421830e-02j, -1.05109876e-01+1.57078623e-01j,
         1.19776225e-01+5.99047241e-03j,  2.49534530e-02+8.59973666e-02j,
        -7.51379486e-02+1.47419768e-01j, -7.63993824e-02-2.43039757e-02j,
         1.21168284e+01+9.34246694e+00j,  2.04209138e+00+1.20847320e+01j]]),

    np.array([[ 1.19535460e-01-8.28739387e-02j, -1.19542855e-01+1.82469702e-01j,
        -1.05685339e-02+1.85120865e-02j,  2.97109867e-02-5.44724722e-02j,
        -3.78626619e-03-8.36275975e-02j, -8.33094752e-02-2.19034138e-02j,
        -1.75106508e-02-1.38651383e-01j, -8.90941884e-02-2.05199316e-01j,
        -7.01424367e-02-9.53865192e-02j,  1.12013057e-01-7.89705163e-02j,
        -7.64082130e-02+6.89434615e-02j,  1.24635607e-01-9.81059729e-02j,
         2.56429583e+01+1.80478222e+00j, -1.56810008e+01+1.24052244e+01j],
       [-6.62572984e-02-4.33823394e-02j,  1.30912644e-01-1.86185090e-01j,
         6.97770195e-02+3.46944552e-02j, -1.51601004e-01-9.44094215e-02j,
         1.64919016e-01-2.16829892e-02j,  5.95610123e-02-5.34169544e-02j,
        -3.93044324e-02+7.63707488e-02j,  5.99351733e-02-1.47074145e-01j,
        -1.21848716e-02-1.74953745e-01j,  3.57161194e-02+1.00305312e-02j,
         2.01897811e-02-8.19733633e-02j, -5.32802274e-02+4.91627600e-03j,
         7.38160202e+00+1.35857017e+01j, -4.15800816e+00+3.88553156e+00j],
       [-1.09151888e-01+1.08515110e-02j,  1.90399111e-02+1.00640319e-01j,
         7.48709918e-02+1.03901107e-01j,  1.23371877e-02+9.76030822e-02j,
         2.80150074e-02+9.97661391e-02j,  8.31895225e-02+1.07584321e-01j,
        -2.48703886e-02+4.02489114e-02j, -3.91581537e-02+3.05990073e-02j,
         1.92836240e-02-9.00151508e-02j, -2.38214967e-03-1.08312777e-01j,
        -2.09104473e-01-1.25197246e-01j,  8.64593510e-02+4.40923101e-02j,
        -1.29967697e+01+8.71276176e+00j, -3.59986258e+00-6.11174695e+00j],
       [ 6.45437392e-02+8.35519518e-02j, -3.41302464e-02-2.27308276e-02j,
        -5.85162487e-02-1.02996302e-01j, -1.27005356e-02-1.39257160e-01j,
        -2.53944091e-01+1.14692980e-02j, -4.03019900e-02-9.03462738e-02j,
        -9.10228360e-02+5.75459199e-02j, -3.58977393e-03-1.49325447e-01j,
         2.08494294e-02-1.28904369e-02j, -3.84641923e-02-1.38563170e-02j,
         5.58538908e-02-5.99446616e-02j, -1.58503930e-03+1.73992226e-01j,
        -8.12962131e+00+5.17043847e+00j,  8.64364555e+00-1.15929030e+01j],
       [ 1.35238125e-01-2.37146481e-02j, -1.56912092e-01+7.05948345e-02j,
         5.59752801e-02+6.81870335e-02j, -1.28609477e-01-5.96692580e-02j,
        -7.35327482e-03-6.12084979e-02j, -4.43683427e-03+4.41770075e-02j,
         1.49266980e-02-1.65415659e-01j,  5.20551502e-02-2.97389129e-02j,
        -2.66770611e-02+4.06577571e-02j, -2.65489189e-02-1.48621500e-02j,
        -1.00745731e-02-9.89103081e-02j, -1.18945790e-02-1.87183528e-01j,
         2.26533131e+00+8.00678422e+00j,  7.52381600e+00-1.14371976e+01j],
       [ 2.41153173e-02-1.88335757e-02j, -2.58310252e-03-1.04585146e-01j,
         2.22566899e-01-6.68558343e-02j, -2.57039585e-02-1.56015380e-02j,
         1.13950019e-01-6.25923622e-02j, -1.21256420e-01+1.51031374e-01j,
        -7.22634673e-02+6.17371959e-02j, -4.54931569e-02-3.03141062e-02j,
         1.15345360e-01-1.52284795e-01j,  2.04658500e-03+3.65944102e-02j,
        -6.28253011e-02-6.00491410e-02j,  1.41526915e-02-6.64368077e-02j,
         1.89693999e+01+1.20346128e+00j,  5.39123767e+00-8.95037725e-01j]])

    ]






mol_solver = ground_state_solver(f"debugger_mol_N2")
mol_solver.initialise_molecule(n2_mol)


bad_states = []
for bad_state_param in bad_state_parameters:
    bad_states.append(CS_Thouless(mol_solver.M, mol_solver.S, bad_state_param))

# What we're gonna do is calculate the energy through the CS overlap formula and also through the explicit decomposition onto the full occupancy basis. If even that is below the ground state, then something stinky is going on with this molecule.

fbs = bad_states[0] # first bad state

mean_field = scf.RHF(n2_mol).run()

norb = mean_field.mo_coeff.shape[1]
nalpha, nbeta = n2_mol.nelec   # (nα, nβ)

print("Number of orbitals:", norb)
print("Number of electrons")
print("    in alpha states:", nalpha)
print("    in beta states:", nbeta)

strs_a = fci.cistring.gen_occslst(range(norb), nalpha)  # all α bitstrings
strs_b = fci.cistring.gen_occslst(range(norb), nbeta)   # all β bitstrings





